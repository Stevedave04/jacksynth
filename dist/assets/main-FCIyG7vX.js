(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const t of c.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&i(t)}).observe(document,{childList:!0,subtree:!0});function a(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(r){if(r.ep)return;r.ep=!0;const c=a(r);fetch(r.href,c)}})();class De{constructor(e,a){this.audioContext=e,this.analyzer=e.createAnalyser(),this.analyzer.fftSize=2048,this.analyzer.smoothingTimeConstant=.85,a.connect(this.analyzer),this.spectrumCanvas=document.getElementById("spectrumAnalyzer"),this.scopeCanvas=document.getElementById("oscilloscope"),this.spectrumCtx=this.spectrumCanvas.getContext("2d"),this.scopeCtx=this.scopeCanvas.getContext("2d"),this.resizeCanvases(),window.addEventListener("resize",()=>this.resizeCanvases()),this.spectrumData=new Uint8Array(this.analyzer.frequencyBinCount),this.scopeData=new Uint8Array(this.analyzer.frequencyBinCount),this.isActive=!0,this.visualizationType="both",this.draw=this.draw.bind(this),requestAnimationFrame(this.draw),this.setupControls()}resizeCanvases(){const a=document.querySelector(".visualization-container").clientWidth-30,i=150;[this.spectrumCanvas,this.scopeCanvas].forEach(r=>{r.width=a,r.height=i,r.style.width=a+"px",r.style.height=i+"px"})}setupControls(){const e=document.getElementById("toggleViz"),a=document.getElementById("vizType");e.addEventListener("click",()=>{this.isActive=!this.isActive,this.isActive&&requestAnimationFrame(this.draw),e.textContent=this.isActive?"Pause Visualization":"Resume Visualization"}),a.addEventListener("change",i=>{this.visualizationType=i.target.value,this.updateCanvasVisibility()})}updateCanvasVisibility(){switch(this.visualizationType){case"spectrum":this.spectrumCanvas.style.display="block",this.scopeCanvas.style.display="none";break;case"scope":this.spectrumCanvas.style.display="none",this.scopeCanvas.style.display="block";break;case"both":this.spectrumCanvas.style.display="block",this.scopeCanvas.style.display="block";break}}drawSpectrum(){const e=this.spectrumCtx,a=this.spectrumCanvas.width,i=this.spectrumCanvas.height,r=a/this.analyzer.frequencyBinCount*2.5,c=Math.min(this.analyzer.frequencyBinCount,a/r),t=e.createLinearGradient(0,0,0,i);t.addColorStop(0,"rgba(0, 0, 0, 0.8)"),t.addColorStop(1,"rgba(0, 0, 0, 0.2)"),e.fillStyle=t,e.fillRect(0,0,a,i),this.analyzer.getByteFrequencyData(this.spectrumData);for(let u=0;u<c;u++){const l=this.spectrumData[u]/255*i,m=u/c*270+180;e.fillStyle=`hsla(${m}, 100%, 50%, 0.85)`,e.beginPath(),e.roundRect(u*r,i-l,r-1,l,[2,2,0,0]),e.fill()}}drawOscilloscope(){const e=this.scopeCtx,a=this.scopeCanvas.width,i=this.scopeCanvas.height;e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(0,0,a,i),this.analyzer.getByteTimeDomainData(this.scopeData),e.beginPath(),e.lineWidth=2,e.strokeStyle="#00ff88";const r=a/this.scopeData.length;let c=0;for(let t=0;t<this.scopeData.length;t++){const l=this.scopeData[t]/128*i/2;t===0?e.moveTo(c,l):e.lineTo(c,l),c+=r}e.shadowBlur=10,e.shadowColor="#00ff88",e.stroke(),e.shadowBlur=0}draw(){this.isActive&&((this.visualizationType==="spectrum"||this.visualizationType==="both")&&this.drawSpectrum(),(this.visualizationType==="scope"||this.visualizationType==="both")&&this.drawOscilloscope(),requestAnimationFrame(this.draw))}}const G={C3:{freq:130.81,key:"z"},"C#3":{freq:138.59,key:"s"},D3:{freq:146.83,key:"x"},"D#3":{freq:155.56,key:"d"},E3:{freq:164.81,key:"c"},F3:{freq:174.61,key:"v"},"F#3":{freq:185,key:"g"},G3:{freq:196,key:"b"},"G#3":{freq:207.65,key:"h"},A3:{freq:220,key:"n"},"A#3":{freq:233.08,key:"j"},B3:{freq:246.94,key:"m"},C4:{freq:261.63,key:"q"},"C#4":{freq:277.18,key:"2"},D4:{freq:293.66,key:"w"},"D#4":{freq:311.13,key:"3"},E4:{freq:329.63,key:"e"},F4:{freq:349.23,key:"r"},"F#4":{freq:369.99,key:"5"},G4:{freq:392,key:"t"},"G#4":{freq:415.3,key:"6"},A4:{freq:440,key:"y"},"A#4":{freq:466.16,key:"7"},B4:{freq:493.88,key:"u"},C5:{freq:523.25,key:"i"},"C#5":{freq:554.37,key:"9"},D5:{freq:587.33,key:"o"},"D#5":{freq:622.25,key:"0"},E5:{freq:659.25,key:"p"},F5:{freq:698.46,key:"["},"F#5":{freq:739.99,key:"="},G5:{freq:783.99,key:"]"},"G#5":{freq:830.61,key:"\\"},A5:{freq:880,key:"a"},"A#5":{freq:932.33,key:"l"},B5:{freq:987.77,key:";"}};function Fe(s){const{keyboardDiv:e,octaves:a,initAudioContext:i,startNote:r,stopNote:c}=s;if(!e){console.error("Keyboard div not found!");return}e.innerHTML="";const t=document.createElement("div");t.className="white-keys";const u=document.createElement("div");u.className="black-keys";const l=[{note:"C",hasSharp:!0},{note:"D",hasSharp:!0},{note:"E",hasSharp:!1},{note:"F",hasSharp:!0},{note:"G",hasSharp:!0},{note:"A",hasSharp:!0},{note:"B",hasSharp:!1}],m=new Set;let g=!1;e.addEventListener("mousedown",()=>g=!0),e.addEventListener("mouseup",()=>{g=!1,m.forEach(w=>{c(w);const S=document.querySelector(`[data-note="${w}"]`);S&&S.classList.remove("active")}),m.clear()}),e.addEventListener("mouseleave",()=>{g&&(g=!1,m.forEach(w=>{c(w);const S=document.querySelector(`[data-note="${w}"]`);S&&S.classList.remove("active")}),m.clear())}),a.forEach(w=>{l.forEach(({note:S})=>{const k=document.createElement("button");k.className="white-key";const C=S+w;k.dataset.note=C;const v=document.createElement("div");v.className="key-label";const B=G[C]?.key||"";v.innerHTML=`${C}
(${B})`,k.appendChild(v),k.addEventListener("mousedown",()=>{i(),r(C),k.classList.add("active"),m.add(C)}),k.addEventListener("mouseup",()=>{c(C),k.classList.remove("active"),m.delete(C)}),k.addEventListener("mouseleave",()=>{m.has(C)&&(c(C),k.classList.remove("active"),m.delete(C))}),k.addEventListener("mouseenter",()=>{g&&(i(),r(C),k.classList.add("active"),m.add(C))}),t.appendChild(k)})}),a.forEach(w=>{l.forEach(({note:S,hasSharp:k},C)=>{if(k){const v=document.createElement("button");v.className="black-key";const B=S+"#"+w;v.dataset.note=B;const L=document.createElement("div");L.className="key-label";const F=G[B]?.key||"";L.innerHTML=`${B}
(${F})`,v.appendChild(L),v.addEventListener("mousedown",()=>{i(),r(B),v.classList.add("active"),m.add(B)}),v.addEventListener("mouseup",()=>{c(B),v.classList.remove("active"),m.delete(B)}),v.addEventListener("mouseleave",()=>{m.has(B)&&(c(B),v.classList.remove("active"),m.delete(B))}),v.addEventListener("mouseenter",()=>{g&&(i(),r(B),v.classList.add("active"),m.add(B))}),u.appendChild(v)}})}),e.appendChild(t),e.appendChild(u),window.addEventListener("resize",()=>{const w=u.querySelectorAll(".black-key"),S=t.querySelectorAll(".white-key");if(S.length===0)return;const k=S[0].offsetWidth;w.forEach(C=>{const v=C.dataset.note,B=v.charAt(0),L=parseInt(v.slice(-1)),F=a.indexOf(L);let q=0;switch(B){case"C":q=.5;break;case"D":q=1.5;break;case"F":q=3.5;break;case"G":q=4.5;break;case"A":q=5.5;break}const O=(F*7+q)*k;C.style.left=`${O}px`})})}function Me(){const s=document.getElementById("drum-machine-grid");if(!s)return;s.innerHTML="",s.className="drum-grid",["Kick","Snare","Hi-Hat","Clap"].forEach((i,r)=>{const c=document.createElement("div");c.className="drum-row";const t=document.createElement("div");t.className="drum-row-label",t.textContent=i,c.appendChild(t);for(let u=0;u<16;u++){const l=document.createElement("div");l.className="drum-pad",l.dataset.row=r,l.dataset.step=u,l.addEventListener("click",m=>{l.classList.toggle("active");const g=new CustomEvent("drumpad-toggle",{detail:{row:r,step:u}});document.dispatchEvent(g)}),c.appendChild(l)}s.appendChild(c)});const a=document.createElement("div");a.className="drum-controls",a.innerHTML=`
    <button id="playDrums">‚ñ∂ Play</button>
    <button id="stopDrums">‚èπ Stop</button>
    <button id="clearDrums">üóë Clear</button>
    <div class="control-group">
      <label for="drumTempo">Tempo:</label>
      <input type="range" id="drumTempo" min="60" max="200" value="120">
      <span class="value-display">120</span>
    </div>
  `,s.appendChild(a)}class ze{constructor(e){this.audioContext=e,this.samples=new Map,this.pattern=Array(4).fill().map(()=>Array(16).fill(!1)),this.playing=!1,this.currentStep=0,this.tempo=120,this.intervalId=null,this.drumTypes={kick:{type:"kick"},snare:{type:"snare"},hihat:{type:"hihat"},clap:{type:"clap"}},this.createSyntheticSamples()}createSyntheticSamples(){Object.entries(this.drumTypes).forEach(([e,a])=>{this.samples.set(e,a)})}playSample(e){const a=this.samples.get(e);if(!a)return;const i=this.audioContext.currentTime;switch(a.type){case"kick":this.playKick(i);break;case"snare":this.playSnare(i);break;case"hihat":this.playHiHat(i);break;case"clap":this.playClap(i);break}}playKick(e){const a=this.audioContext.createOscillator(),i=this.audioContext.createGain(),r=this.audioContext.createBiquadFilter();a.type="sine",a.frequency.setValueAtTime(60,e),a.frequency.exponentialRampToValueAtTime(.01,e+.5),r.type="lowpass",r.frequency.setValueAtTime(100,e),i.gain.setValueAtTime(.8,e),i.gain.exponentialRampToValueAtTime(.01,e+.5),a.connect(r),r.connect(i),i.connect(this.audioContext.destination),a.start(e),a.stop(e+.5)}playSnare(e){const a=this.audioContext.sampleRate*.2,i=this.audioContext.createBuffer(1,a,this.audioContext.sampleRate),r=i.getChannelData(0);for(let g=0;g<a;g++)r[g]=Math.random()*2-1;const c=this.audioContext.createBufferSource();c.buffer=i;const t=this.audioContext.createBiquadFilter();t.type="highpass",t.frequency.setValueAtTime(1e3,e);const u=this.audioContext.createGain();u.gain.setValueAtTime(.5,e),u.gain.exponentialRampToValueAtTime(.01,e+.2);const l=this.audioContext.createOscillator();l.type="triangle",l.frequency.setValueAtTime(200,e);const m=this.audioContext.createGain();m.gain.setValueAtTime(.3,e),m.gain.exponentialRampToValueAtTime(.01,e+.1),c.connect(t),t.connect(u),u.connect(this.audioContext.destination),l.connect(m),m.connect(this.audioContext.destination),c.start(e),c.stop(e+.2),l.start(e),l.stop(e+.1)}playHiHat(e){const a=this.audioContext.sampleRate*.1,i=this.audioContext.createBuffer(1,a,this.audioContext.sampleRate),r=i.getChannelData(0);for(let l=0;l<a;l++)r[l]=Math.random()*2-1;const c=this.audioContext.createBufferSource();c.buffer=i;const t=this.audioContext.createBiquadFilter();t.type="highpass",t.frequency.setValueAtTime(8e3,e);const u=this.audioContext.createGain();u.gain.setValueAtTime(.3,e),u.gain.exponentialRampToValueAtTime(.01,e+.1),c.connect(t),t.connect(u),u.connect(this.audioContext.destination),c.start(e),c.stop(e+.1)}playClap(e){for(let a=0;a<3;a++){const i=a*.01,r=this.audioContext.sampleRate*.05,c=this.audioContext.createBuffer(1,r,this.audioContext.sampleRate),t=c.getChannelData(0);for(let g=0;g<r;g++)t[g]=Math.random()*2-1;const u=this.audioContext.createBufferSource();u.buffer=c;const l=this.audioContext.createBiquadFilter();l.type="bandpass",l.frequency.setValueAtTime(1e3,e+i),l.Q.setValueAtTime(1,e+i);const m=this.audioContext.createGain();m.gain.setValueAtTime(.4,e+i),m.gain.exponentialRampToValueAtTime(.01,e+i+.05),u.connect(l),l.connect(m),m.connect(this.audioContext.destination),u.start(e+i),u.stop(e+i+.05)}}toggleStep(e,a){return this.pattern[e][a]=!this.pattern[e][a],this.pattern[e][a]}start(){if(this.playing)return;this.playing=!0,this.currentStep=0;const e=60/this.tempo/4;this.intervalId=setInterval(()=>{this.playStep(),this.updateStepIndicator(),this.currentStep=(this.currentStep+1)%16},e*1e3)}stop(){this.playing&&(this.playing=!1,clearInterval(this.intervalId),this.currentStep=0,this.updateStepIndicator())}playStep(){["kick","snare","hihat","clap"].forEach((a,i)=>{this.pattern[i][this.currentStep]&&this.playSample(a)})}updateStepIndicator(){document.querySelectorAll(".drum-pad").forEach((a,i)=>{const r=i%16;a.classList.toggle("playing",r===this.currentStep&&this.playing)})}setTempo(e){this.tempo=e,this.playing&&(this.stop(),this.start())}clear(){this.pattern=Array(4).fill().map(()=>Array(16).fill(!1)),this.updateGrid()}updateGrid(){document.querySelectorAll(".drum-pad").forEach(a=>{const i=parseInt(a.dataset.row),r=parseInt(a.dataset.step);a.classList.toggle("active",this.pattern[i][r])})}}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM fully loaded and parsed");let s,e,a,i=[],r;const c=new Set,t={};function u(){console.log("Envelope follower setup complete")}function l(){if(s)return s;try{s=new(window.AudioContext||window.webkitAudioContext),e=s.createDynamicsCompressor(),e.connect(s.destination);const n=new De(s,e);m(),u(),console.log("Audio context initialized successfully")}catch(n){console.error("Failed to initialize audio context:",n)}return s}function m(){if(!s){console.error("AudioContext not initialized before setting up effects chain.");return}t.filterNode=s.createBiquadFilter(),t.filterNode.type="lowpass",t.filterNode.frequency.value=2e4,t.filterNode.Q.value=1,t.distortionNode=s.createWaveShaper();const n=50,o=44100,p=new Float32Array(o),h=Math.PI/180;for(let f=0;f<o;++f){const d=f*2/o-1;p[f]=(3+n)*d*20*h/(Math.PI+n*Math.abs(d))}t.distortionNode.curve=p,t.distortionNode.oversample="4x",t.delayNode=s.createDelay(5),t.delayNode.delayTime.value=.3,t.delayFeedbackNode=s.createGain(),t.delayFeedbackNode.gain.value=.4,t.delayDryNode=s.createGain(),t.delayDryNode.gain.value=.7,t.delayWetNode=s.createGain(),t.delayWetNode.gain.value=.3,t.reverbNode=s.createConvolver();const b=2,y=s.sampleRate,x=s.createBuffer(2,b*y,y);for(let f=0;f<x.numberOfChannels;f++){const d=x.getChannelData(f);for(let E=0;E<d.length;E++)d[E]=(Math.random()*2-1)*Math.pow(1-E/d.length,2)}t.reverbNode.buffer=x,t.reverbDryNode=s.createGain(),t.reverbDryNode.gain.value=.7,t.reverbWetNode=s.createGain(),t.reverbWetNode.gain.value=.3,g(),console.log("Effects chain initialized successfully")}function g(){if(!s||!t.filterNode){console.error("Effects chain not initialized");return}Object.values(t).forEach(d=>{if(d&&d.disconnect)try{d.disconnect()}catch{}});const n=document.getElementById("distortion-enabled")?.checked||!1,o=document.getElementById("delay-enabled")?.checked||!1,p=document.getElementById("reverb-enabled")?.checked||!1,h=document.getElementById("compressor-enabled")?.checked||!1,b=Number.parseFloat(document.getElementById("filterCutoff")?.value||2e4),y=Number.parseFloat(document.getElementById("filterResonance")?.value||1);if(t.filterNode.frequency.value=b,t.filterNode.Q.value=y,n){const E=Number.parseFloat(document.getElementById("distortion-amount")?.value||20),N=44100,A=new Float32Array(N),V=Math.PI/180;for(let T=0;T<N;++T){const z=T*2/N-1;A[T]=(3+E)*z*20*V/(Math.PI+E*Math.abs(z))}t.distortionNode.curve=A}if(o){const d=Number.parseFloat(document.getElementById("delay-time")?.value||.3),E=Number.parseFloat(document.getElementById("delay-feedback")?.value||.4),N=Number.parseFloat(document.getElementById("delay-mix")?.value||.3);t.delayNode.delayTime.value=d,t.delayFeedbackNode.gain.value=E,t.delayWetNode.gain.value=N,t.delayDryNode.gain.value=1-N}if(p){const d=Number.parseFloat(document.getElementById("reverb-decay")?.value||2),E=Number.parseFloat(document.getElementById("reverb-mix")?.value||.3),N=s.sampleRate,A=d*N,V=s.createBuffer(2,A,N);for(let T=0;T<V.numberOfChannels;T++){const z=V.getChannelData(T);for(let j=0;j<z.length;j++)z[j]=(Math.random()*2-1)*Math.pow(1-j/z.length,2)}t.reverbNode.buffer=V,t.reverbWetNode.gain.value=E,t.reverbDryNode.gain.value=1-E}if(h){const d=Number.parseFloat(document.getElementById("compressor-threshold")?.value||-24),E=Number.parseFloat(document.getElementById("compressor-ratio")?.value||4),N=Number.parseFloat(document.getElementById("compressor-attack")?.value||5)/1e3,A=Number.parseFloat(document.getElementById("compressor-release")?.value||250)/1e3;e.threshold.value=d,e.ratio.value=E,e.attack.value=N,e.release.value=A}let f=t.filterNode;if(n&&(f.connect(t.distortionNode),f=t.distortionNode),o){f.connect(t.delayDryNode),f.connect(t.delayNode),t.delayNode.connect(t.delayFeedbackNode),t.delayFeedbackNode.connect(t.delayNode),t.delayNode.connect(t.delayWetNode);const d=s.createGain();t.delayDryNode.connect(d),t.delayWetNode.connect(d),f=d}if(p){f.connect(t.reverbDryNode),f.connect(t.reverbNode),t.reverbNode.connect(t.reverbWetNode);const d=s.createGain();t.reverbDryNode.connect(d),t.reverbWetNode.connect(d),f=d}f.connect(e),console.log("Effects chain updated successfully")}function w(){const n=s.createMediaStreamDestination();e.connect(n),a=new MediaRecorder(n.stream),a.ondataavailable=o=>{i.push(o.data)},a.onstop=()=>{const o=new Blob(i,{type:"audio/wav"}),p=URL.createObjectURL(o),h=document.getElementById("downloadButton");h.href=p,h.download="recording.wav",h.disabled=!1}}document.getElementById("recordButton")?.addEventListener("click",()=>{s||l(),a||w(),i=[],a.start(),document.getElementById("recordButton").classList.add("recording"),document.getElementById("recordButton").disabled=!0,document.getElementById("stopButton").disabled=!1}),document.getElementById("stopButton")?.addEventListener("click",()=>{a.stop(),document.getElementById("recordButton").classList.remove("recording"),document.getElementById("recordButton").disabled=!1,document.getElementById("stopButton").disabled=!0});try{if(!document.getElementById("keyboard"))throw new Error("Keyboard div not found");console.log("Keyboard div found")}catch(n){console.error("Failed to find keyboard div:",n);const o=document.getElementById("keyboard-error");o&&(o.style.display="block")}document.getElementById("keyboard");const S=document.getElementById("resetToDefault"),k=document.getElementById("waveform1"),C=document.getElementById("waveform2"),v=document.getElementById("detune"),B=document.getElementById("oscMix"),L=document.getElementById("volume"),F=document.getElementById("attack"),q=document.getElementById("decay"),O=document.getElementById("sustain"),U=document.getElementById("release"),ge=document.getElementById("filterCutoff"),be=document.getElementById("filterResonance"),Ee=document.getElementById("lfoWaveform"),ke=document.getElementById("lfoFrequency"),Ce=document.getElementById("lfoAmount"),Be=document.getElementById("lfoTarget"),W=document.getElementById("arpEnabled"),X=document.getElementById("arpPattern"),Y=document.getElementById("arpRate"),Q=document.getElementById("arpOctaves"),Z=document.getElementById("reverb-enabled"),ee=document.getElementById("reverb-mix"),te=document.getElementById("reverb-decay"),ne=document.getElementById("delay-enabled"),ae=document.getElementById("delay-time"),oe=document.getElementById("delay-feedback"),se=document.getElementById("delay-mix"),re=document.getElementById("distortion-enabled"),ie=document.getElementById("distortion-amount"),ce=document.getElementById("distortion-tone"),Ne=document.getElementById("chorus-enabled"),Se=document.getElementById("chorus-rate"),Ie=document.getElementById("chorus-depth"),we=document.getElementById("chorus-mix"),le=document.getElementById("compressor-enabled"),de=document.getElementById("compressor-threshold"),ue=document.getElementById("compressor-ratio"),me=document.getElementById("compressor-attack"),pe=document.getElementById("compressor-release"),ye=document.querySelectorAll(".tab-button"),xe=document.querySelectorAll(".tab-content"),R={};let K=!1,I=[],P=null;const $=Object.fromEntries(Object.entries(G).map(([n,o])=>[n,o.freq])),H={},_={};Object.entries(G).forEach(([n,o])=>{o.key&&(_[o.key]=n)}),ye.forEach(n=>{n.addEventListener("click",()=>{console.log("Tab clicked:",n.dataset.tab),ye.forEach(h=>h.classList.remove("active")),xe.forEach(h=>h.classList.remove("active")),n.classList.add("active");const o=n.dataset.tab,p=document.getElementById(`${o}-tab`);p?(p.classList.add("active"),console.log("Activated tab content:",o),o==="drum-machine"&&(Me(),Le())):console.error("Tab content not found:",o)})});function he(){document.querySelectorAll('input[type="range"]').forEach(n=>{const o=n.nextElementSibling;o&&o.classList.contains("value-display")&&(o.textContent=n.value,n.addEventListener("input",()=>{o.textContent=n.value}))})}function qe(){k.value="sine",C.value="sine",v.value="0",B.value="0.5",L.value="0.5",F.value="0.1",q.value="0.1",O.value="0.8",U.value="0.5",ge.value="20000",be.value="1",Ee.value="sine",ke.value="1",Ce.value="10",Be.value="filterCutoff",W.checked=!1,X.value="up",Y.value="4",Q.value="1",Z.checked=!0,ee.value="0.3",te.value="2",ne.checked=!0,ae.value="0.3",oe.value="0.4",se.value="0.3",re.checked=!1,ie.value="20",ce.value="4000",Ne.checked=!1,Se.value="1.5",Ie.value="0.7",we.value="0.5",le.checked=!0,de.value="-24",ue.value="4",me.value="5",pe.value="250",J(),Object.keys(H).forEach(n=>{H[n]=0}),Ae(),he(),s&&g(),console.log("Reset to default values"),alert("All settings have been reset to default values")}Q?.addEventListener("input",()=>{K&&(J(),fe())});function M(n,o=null){if(s||l(),R[n])return console.log(`Cleaning up existing note ${n}`),D(n),setTimeout(()=>M(n,o),1);const p=o||$[n];if(!p){console.warn(`Note frequency not found for ${n}`);return}const h=s.createOscillator(),b=s.createOscillator();h.type=k.value,b.type=C.value,h.frequency.setValueAtTime(p,s.currentTime),b.frequency.setValueAtTime(p*Math.pow(2,v.value/1200),s.currentTime);const y=s.createGain(),x=s.createGain(),f=Number.parseFloat(B.value);y.gain.setValueAtTime(f,s.currentTime),x.gain.setValueAtTime(1-f,s.currentTime),h.connect(y),b.connect(x);const d=s.createGain();d.gain.setValueAtTime(0,s.currentTime),y.connect(d),x.connect(d),d.connect(t.filterNode);const E=Number.parseFloat(F.value),N=Number.parseFloat(q.value),A=Number.parseFloat(O.value);Number.parseFloat(U.value),d.gain.linearRampToValueAtTime(1,s.currentTime+E),d.gain.linearRampToValueAtTime(A,s.currentTime+E+N),h.start(),b.start(),R[n]={osc1:h,osc2:b,gainNode1:y,gainNode2:x,adsrGain:d}}function D(n){if(!s||!R[n])return;const o=R[n],{osc1:p,osc2:h,adsrGain:b}=o,y=Number.parseFloat(U.value);b.gain.cancelScheduledValues(s.currentTime),b.gain.linearRampToValueAtTime(0,s.currentTime+y),setTimeout(()=>{p.stop(),h.stop(),p.disconnect(),h.disconnect(),b.disconnect(),delete R[n]},y*1e3)}document.addEventListener("keydown",n=>{const o=_[n.key];if(o&&!n.repeat){if(W.checked)ve(o,!0);else if(!c.has(o)){M(o),c.add(o);const p=document.querySelector(`[data-note="${o}"]`);p&&p.classList.add("active")}}}),document.addEventListener("keyup",n=>{const o=_[n.key];if(o)if(W.checked)ve(o,!1);else{D(o),c.delete(o);const p=document.querySelector(`[data-note="${o}"]`);p&&p.classList.remove("active")}}),window.addEventListener("blur",()=>{c.forEach(n=>{D(n);const o=document.querySelector(`[data-note="${n}"]`);o&&o.classList.remove("active")}),c.clear()});function Ae(){Object.keys(H).forEach(n=>{$[n]=G[n].freq*Math.pow(2,H[n]/1200)})}function fe(){s||l(),K=!0;const o=60/(Number.parseInt(Y.value)*15)*1e3,p=X.value,h=Number.parseInt(Q.value);let b=0;P=setInterval(()=>{if(I.length===0)return;let y;const x=I.length*h;switch(p){case"up":y=I[b%I.length];const f=Math.floor(b/I.length),d=$[y]*Math.pow(2,f);M(y,d),setTimeout(()=>D(y),o*.9),b=(b+1)%x;break;case"down":b=(x+b-1)%x,y=I[b%I.length],M(y),setTimeout(()=>D(y),o*.9);break;case"random":y=I[Math.floor(Math.random()*I.length)];const E=Math.floor(Math.random()*h),N=$[y]*Math.pow(2,E);M(y,N),setTimeout(()=>D(y),o*.9);break}},o)}function ve(n,o){W.checked&&(o&&!I.includes(n)?(I.push(n),K||fe()):o||(I=I.filter(p=>p!==n),I.length===0&&J()))}function J(){P&&(clearInterval(P),P=null),K=!1}function Te(){const n={keyboardDiv:document.getElementById("keyboard"),octaves:[3,4,5],initAudioContext:l,startNote:M,stopNote:D};Fe(n),console.log("Keyboard initialized")}function Le(){s||l(),r=new ze(s),console.log("Drum machine initialized with synthetic samples"),document.addEventListener("drumpad-toggle",n=>{const{row:o,step:p}=n.detail;r.toggleStep(o,p)}),document.getElementById("playDrums")?.addEventListener("click",()=>{r.start(),document.getElementById("playDrums").disabled=!0,document.getElementById("stopDrums").disabled=!1}),document.getElementById("stopDrums")?.addEventListener("click",()=>{r.stop(),document.getElementById("playDrums").disabled=!1,document.getElementById("stopDrums").disabled=!0}),document.getElementById("clearDrums")?.addEventListener("click",()=>{r.clear()}),document.getElementById("drumTempo")?.addEventListener("input",n=>{r.setTempo(parseInt(n.target.value)),n.target.nextElementSibling.textContent=n.target.value})}[Z,ee,te,ne,ae,oe,se,re,ie,ce,le,de,ue,me,pe].forEach(n=>{n&&(n.addEventListener("change",g),n.addEventListener("input",g))}),S?.addEventListener("click",qe),l(),Te(),he(),console.log("JackSynth initialized successfully")});

(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const t of i)if(t.type==="childList")for(const c of t.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function s(i){const t={};return i.integrity&&(t.integrity=i.integrity),i.referrerPolicy&&(t.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?t.credentials="include":i.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function r(i){if(i.ep)return;i.ep=!0;const t=s(i);fetch(i.href,t)}})();class Ve{constructor(e,s){this.audioContext=e,this.analyzer=e.createAnalyser(),this.analyzer.fftSize=2048,this.analyzer.smoothingTimeConstant=.85,s.connect(this.analyzer),this.spectrumCanvas=document.getElementById("spectrumAnalyzer"),this.scopeCanvas=document.getElementById("oscilloscope"),this.spectrumCtx=this.spectrumCanvas.getContext("2d"),this.scopeCtx=this.scopeCanvas.getContext("2d"),this.resizeCanvases(),window.addEventListener("resize",()=>this.resizeCanvases()),this.spectrumData=new Uint8Array(this.analyzer.frequencyBinCount),this.scopeData=new Uint8Array(this.analyzer.frequencyBinCount),this.isActive=!0,this.visualizationType="both",this.draw=this.draw.bind(this),requestAnimationFrame(this.draw),this.setupControls()}resizeCanvases(){const s=document.querySelector(".visualization-container").clientWidth-30,r=150;[this.spectrumCanvas,this.scopeCanvas].forEach(i=>{i.width=s,i.height=r,i.style.width=s+"px",i.style.height=r+"px"})}setupControls(){const e=document.getElementById("toggleViz"),s=document.getElementById("vizType");e.addEventListener("click",()=>{this.isActive=!this.isActive,this.isActive&&requestAnimationFrame(this.draw),e.textContent=this.isActive?"Pause Visualization":"Resume Visualization"}),s.addEventListener("change",r=>{this.visualizationType=r.target.value,this.updateCanvasVisibility()})}updateCanvasVisibility(){switch(this.visualizationType){case"spectrum":this.spectrumCanvas.style.display="block",this.scopeCanvas.style.display="none";break;case"scope":this.spectrumCanvas.style.display="none",this.scopeCanvas.style.display="block";break;case"both":this.spectrumCanvas.style.display="block",this.scopeCanvas.style.display="block";break}}drawSpectrum(){const e=this.spectrumCtx,s=this.spectrumCanvas.width,r=this.spectrumCanvas.height,i=s/this.analyzer.frequencyBinCount*2.5,t=Math.min(this.analyzer.frequencyBinCount,s/i),c=e.createLinearGradient(0,0,0,r);c.addColorStop(0,"rgba(0, 0, 0, 0.8)"),c.addColorStop(1,"rgba(0, 0, 0, 0.2)"),e.fillStyle=c,e.fillRect(0,0,s,r),this.analyzer.getByteFrequencyData(this.spectrumData);for(let l=0;l<t;l++){const d=this.spectrumData[l]/255*r,m=l/t*270+180;e.fillStyle=`hsla(${m}, 100%, 50%, 0.85)`,e.beginPath(),e.roundRect(l*i,r-d,i-1,d,[2,2,0,0]),e.fill()}}drawOscilloscope(){const e=this.scopeCtx,s=this.scopeCanvas.width,r=this.scopeCanvas.height;e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(0,0,s,r),this.analyzer.getByteTimeDomainData(this.scopeData),e.beginPath(),e.lineWidth=2,e.strokeStyle="#00ff88";const i=s/this.scopeData.length;let t=0;for(let c=0;c<this.scopeData.length;c++){const d=this.scopeData[c]/128*r/2;c===0?e.moveTo(t,d):e.lineTo(t,d),t+=i}e.shadowBlur=10,e.shadowColor="#00ff88",e.stroke(),e.shadowBlur=0}draw(){this.isActive&&((this.visualizationType==="spectrum"||this.visualizationType==="both")&&this.drawSpectrum(),(this.visualizationType==="scope"||this.visualizationType==="both")&&this.drawOscilloscope(),requestAnimationFrame(this.draw))}}const G={C3:{freq:130.81,key:"z"},"C#3":{freq:138.59,key:"s"},D3:{freq:146.83,key:"x"},"D#3":{freq:155.56,key:"d"},E3:{freq:164.81,key:"c"},F3:{freq:174.61,key:"v"},"F#3":{freq:185,key:"g"},G3:{freq:196,key:"b"},"G#3":{freq:207.65,key:"h"},A3:{freq:220,key:"n"},"A#3":{freq:233.08,key:"j"},B3:{freq:246.94,key:"m"},C4:{freq:261.63,key:"q"},"C#4":{freq:277.18,key:"2"},D4:{freq:293.66,key:"w"},"D#4":{freq:311.13,key:"3"},E4:{freq:329.63,key:"e"},F4:{freq:349.23,key:"r"},"F#4":{freq:369.99,key:"5"},G4:{freq:392,key:"t"},"G#4":{freq:415.3,key:"6"},A4:{freq:440,key:"y"},"A#4":{freq:466.16,key:"7"},B4:{freq:493.88,key:"u"},C5:{freq:523.25,key:"i"},"C#5":{freq:554.37,key:"9"},D5:{freq:587.33,key:"o"},"D#5":{freq:622.25,key:"0"},E5:{freq:659.25,key:"p"},F5:{freq:698.46,key:"["},"F#5":{freq:739.99,key:"="},G5:{freq:783.99,key:"]"},"G#5":{freq:830.61,key:"\\"},A5:{freq:880,key:"a"},"A#5":{freq:932.33,key:"l"},B5:{freq:987.77,key:";"}};function Ge(S){const{keyboardDiv:e,octaves:s,initAudioContext:r,startNote:i,stopNote:t}=S;if(!e){console.error("Keyboard div not found!");return}e.innerHTML="";const c=document.createElement("div");c.className="white-keys";const l=document.createElement("div");l.className="black-keys";const d=[{note:"C",hasSharp:!0},{note:"D",hasSharp:!0},{note:"E",hasSharp:!1},{note:"F",hasSharp:!0},{note:"G",hasSharp:!0},{note:"A",hasSharp:!0},{note:"B",hasSharp:!1}],m=new Set;let b=!1;e.addEventListener("mousedown",()=>b=!0),e.addEventListener("mouseup",()=>{b=!1,m.forEach(a=>{t(a);const I=document.querySelector(`[data-note="${a}"]`);I&&I.classList.remove("active")}),m.clear()}),e.addEventListener("mouseleave",()=>{b&&(b=!1,m.forEach(a=>{t(a);const I=document.querySelector(`[data-note="${a}"]`);I&&I.classList.remove("active")}),m.clear())}),s.forEach(a=>{d.forEach(({note:I})=>{const f=document.createElement("button");f.className="white-key";const C=I+a;f.dataset.note=C;const p=document.createElement("div");p.className="key-label";const B=G[C]?.key||"";p.innerHTML=`${C}
(${B})`,f.appendChild(p),f.addEventListener("mousedown",()=>{r(),i(C),f.classList.add("active"),m.add(C)}),f.addEventListener("mouseup",()=>{t(C),f.classList.remove("active"),m.delete(C)}),f.addEventListener("mouseleave",()=>{m.has(C)&&(t(C),f.classList.remove("active"),m.delete(C))}),f.addEventListener("mouseenter",()=>{b&&(r(),i(C),f.classList.add("active"),m.add(C))}),c.appendChild(f)})}),s.forEach(a=>{d.forEach(({note:I,hasSharp:f},C)=>{if(f){const p=document.createElement("button");p.className="black-key";const B=I+"#"+a;p.dataset.note=B;const L=document.createElement("div");L.className="key-label";const F=G[B]?.key||"";L.innerHTML=`${B}
(${F})`,p.appendChild(L),p.addEventListener("mousedown",()=>{r(),i(B),p.classList.add("active"),m.add(B)}),p.addEventListener("mouseup",()=>{t(B),p.classList.remove("active"),m.delete(B)}),p.addEventListener("mouseleave",()=>{m.has(B)&&(t(B),p.classList.remove("active"),m.delete(B))}),p.addEventListener("mouseenter",()=>{b&&(r(),i(B),p.classList.add("active"),m.add(B))}),l.appendChild(p)}})}),e.appendChild(c),e.appendChild(l),window.addEventListener("resize",()=>{const a=l.querySelectorAll(".black-key"),I=c.querySelectorAll(".white-key");if(I.length===0)return;const f=I[0].offsetWidth;a.forEach(C=>{const p=C.dataset.note,B=p.charAt(0),L=parseInt(p.slice(-1)),F=s.indexOf(L);let q=0;switch(B){case"C":q=.5;break;case"D":q=1.5;break;case"F":q=3.5;break;case"G":q=4.5;break;case"A":q=5.5;break}const O=(F*7+q)*f;C.style.left=`${O}px`})})}function Oe(){const S=document.getElementById("drum-machine-grid");if(!S)return;S.innerHTML="",S.className="drum-grid",["Kick","Snare","Hi-Hat","Clap"].forEach((r,i)=>{const t=document.createElement("div");t.className="drum-row";const c=document.createElement("div");c.className="drum-row-label",c.textContent=r,t.appendChild(c);for(let l=0;l<16;l++){const d=document.createElement("div");d.className="drum-pad",d.dataset.row=i,d.dataset.step=l,d.addEventListener("click",m=>{d.classList.toggle("active");const b=new CustomEvent("drumpad-toggle",{detail:{row:i,step:l}});document.dispatchEvent(b)}),t.appendChild(d)}S.appendChild(t)});const s=document.createElement("div");s.className="drum-controls",s.innerHTML=`
    <button id="playDrums">‚ñ∂ Play</button>
    <button id="stopDrums">‚èπ Stop</button>
    <button id="clearDrums">üóë Clear</button>
    <div class="control-group">
      <label for="drumTempo">Tempo:</label>
      <input type="range" id="drumTempo" min="60" max="200" value="120">
      <span class="value-display">120</span>
    </div>
  `,S.appendChild(s)}class We{constructor(e){this.audioContext=e,this.samples=new Map,this.pattern=Array(4).fill().map(()=>Array(16).fill(!1)),this.playing=!1,this.currentStep=0,this.tempo=120,this.intervalId=null,this.drumTypes={kick:{type:"kick"},snare:{type:"snare"},hihat:{type:"hihat"},clap:{type:"clap"}},this.createSyntheticSamples()}createSyntheticSamples(){Object.entries(this.drumTypes).forEach(([e,s])=>{this.samples.set(e,s)})}playSample(e){const s=this.samples.get(e);if(!s)return;const r=this.audioContext.currentTime;switch(s.type){case"kick":this.playKick(r);break;case"snare":this.playSnare(r);break;case"hihat":this.playHiHat(r);break;case"clap":this.playClap(r);break}}playKick(e){const s=this.audioContext.createOscillator(),r=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();s.type="sine",s.frequency.setValueAtTime(60,e),s.frequency.exponentialRampToValueAtTime(.01,e+.5),i.type="lowpass",i.frequency.setValueAtTime(100,e),r.gain.setValueAtTime(.8,e),r.gain.exponentialRampToValueAtTime(.01,e+.5),s.connect(i),i.connect(r),r.connect(this.audioContext.destination),s.start(e),s.stop(e+.5)}playSnare(e){const s=this.audioContext.sampleRate*.2,r=this.audioContext.createBuffer(1,s,this.audioContext.sampleRate),i=r.getChannelData(0);for(let b=0;b<s;b++)i[b]=Math.random()*2-1;const t=this.audioContext.createBufferSource();t.buffer=r;const c=this.audioContext.createBiquadFilter();c.type="highpass",c.frequency.setValueAtTime(1e3,e);const l=this.audioContext.createGain();l.gain.setValueAtTime(.5,e),l.gain.exponentialRampToValueAtTime(.01,e+.2);const d=this.audioContext.createOscillator();d.type="triangle",d.frequency.setValueAtTime(200,e);const m=this.audioContext.createGain();m.gain.setValueAtTime(.3,e),m.gain.exponentialRampToValueAtTime(.01,e+.1),t.connect(c),c.connect(l),l.connect(this.audioContext.destination),d.connect(m),m.connect(this.audioContext.destination),t.start(e),t.stop(e+.2),d.start(e),d.stop(e+.1)}playHiHat(e){const s=this.audioContext.sampleRate*.1,r=this.audioContext.createBuffer(1,s,this.audioContext.sampleRate),i=r.getChannelData(0);for(let d=0;d<s;d++)i[d]=Math.random()*2-1;const t=this.audioContext.createBufferSource();t.buffer=r;const c=this.audioContext.createBiquadFilter();c.type="highpass",c.frequency.setValueAtTime(8e3,e);const l=this.audioContext.createGain();l.gain.setValueAtTime(.3,e),l.gain.exponentialRampToValueAtTime(.01,e+.1),t.connect(c),c.connect(l),l.connect(this.audioContext.destination),t.start(e),t.stop(e+.1)}playClap(e){for(let s=0;s<3;s++){const r=s*.01,i=this.audioContext.sampleRate*.05,t=this.audioContext.createBuffer(1,i,this.audioContext.sampleRate),c=t.getChannelData(0);for(let b=0;b<i;b++)c[b]=Math.random()*2-1;const l=this.audioContext.createBufferSource();l.buffer=t;const d=this.audioContext.createBiquadFilter();d.type="bandpass",d.frequency.setValueAtTime(1e3,e+r),d.Q.setValueAtTime(1,e+r);const m=this.audioContext.createGain();m.gain.setValueAtTime(.4,e+r),m.gain.exponentialRampToValueAtTime(.01,e+r+.05),l.connect(d),d.connect(m),m.connect(this.audioContext.destination),l.start(e+r),l.stop(e+r+.05)}}toggleStep(e,s){return this.pattern[e][s]=!this.pattern[e][s],this.pattern[e][s]}start(){if(this.playing)return;this.playing=!0,this.currentStep=0;const e=60/this.tempo/4;this.intervalId=setInterval(()=>{this.playStep(),this.updateStepIndicator(),this.currentStep=(this.currentStep+1)%16},e*1e3)}stop(){this.playing&&(this.playing=!1,clearInterval(this.intervalId),this.currentStep=0,this.updateStepIndicator())}playStep(){["kick","snare","hihat","clap"].forEach((s,r)=>{this.pattern[r][this.currentStep]&&this.playSample(s)})}updateStepIndicator(){document.querySelectorAll(".drum-pad").forEach((s,r)=>{const i=r%16;s.classList.toggle("playing",i===this.currentStep&&this.playing)})}setTempo(e){this.tempo=e,this.playing&&(this.stop(),this.start())}clear(){this.pattern=Array(4).fill().map(()=>Array(16).fill(!1)),this.updateGrid()}updateGrid(){document.querySelectorAll(".drum-pad").forEach(s=>{const r=parseInt(s.dataset.row),i=parseInt(s.dataset.step);s.classList.toggle("active",this.pattern[r][i])})}}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM fully loaded and parsed");const S=document.getElementById("themeToggle"),e=S.querySelector(".theme-icon"),s=S.querySelector(".theme-text"),r=localStorage.getItem("theme")||"dark";document.documentElement.setAttribute("data-theme",r),i(r);function i(n){n==="light"?(e.textContent="‚òÄÔ∏è",s.textContent="Light"):(e.textContent="üåô",s.textContent="Dark")}S.addEventListener("click",()=>{const o=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";document.documentElement.setAttribute("data-theme",o),localStorage.setItem("theme",o),i(o)});let t,c,l,d=[],m;const b=new Set,a={};function I(){console.log("Envelope follower setup complete")}function f(){if(t)return t;try{t=new(window.AudioContext||window.webkitAudioContext),c=t.createDynamicsCompressor(),c.connect(t.destination);const n=new Ve(t,c);C(),I(),console.log("Audio context initialized successfully")}catch(n){console.error("Failed to initialize audio context:",n)}return t}function C(){if(!t){console.error("AudioContext not initialized before setting up effects chain.");return}a.filterNode=t.createBiquadFilter(),a.filterNode.type="lowpass",a.filterNode.frequency.value=2e4,a.filterNode.Q.value=1,a.distortionNode=t.createWaveShaper();const n=50,o=44100,h=new Float32Array(o),v=Math.PI/180;for(let g=0;g<o;++g){const u=g*2/o-1;h[g]=(3+n)*u*20*v/(Math.PI+n*Math.abs(u))}a.distortionNode.curve=h,a.distortionNode.oversample="4x",a.delayNode=t.createDelay(5),a.delayNode.delayTime.value=.3,a.delayFeedbackNode=t.createGain(),a.delayFeedbackNode.gain.value=.4,a.delayDryNode=t.createGain(),a.delayDryNode.gain.value=.7,a.delayWetNode=t.createGain(),a.delayWetNode.gain.value=.3,a.reverbNode=t.createConvolver();const E=2,y=t.sampleRate,w=t.createBuffer(2,E*y,y);for(let g=0;g<w.numberOfChannels;g++){const u=w.getChannelData(g);for(let k=0;k<u.length;k++)u[k]=(Math.random()*2-1)*Math.pow(1-k/u.length,2)}a.reverbNode.buffer=w,a.reverbDryNode=t.createGain(),a.reverbDryNode.gain.value=.7,a.reverbWetNode=t.createGain(),a.reverbWetNode.gain.value=.3,p(),console.log("Effects chain initialized successfully")}function p(){if(!t||!a.filterNode){console.error("Effects chain not initialized");return}Object.values(a).forEach(u=>{if(u&&u.disconnect)try{u.disconnect()}catch{}});const n=document.getElementById("distortion-enabled")?.checked||!1,o=document.getElementById("delay-enabled")?.checked||!1,h=document.getElementById("reverb-enabled")?.checked||!1,v=document.getElementById("compressor-enabled")?.checked||!1,E=Number.parseFloat(document.getElementById("filterCutoff")?.value||2e4),y=Number.parseFloat(document.getElementById("filterResonance")?.value||1);if(a.filterNode.frequency.value=E,a.filterNode.Q.value=y,n){const k=Number.parseFloat(document.getElementById("distortion-amount")?.value||20),N=44100,T=new Float32Array(N),V=Math.PI/180;for(let A=0;A<N;++A){const z=A*2/N-1;T[A]=(3+k)*z*20*V/(Math.PI+k*Math.abs(z))}a.distortionNode.curve=T}if(o){const u=Number.parseFloat(document.getElementById("delay-time")?.value||.3),k=Number.parseFloat(document.getElementById("delay-feedback")?.value||.4),N=Number.parseFloat(document.getElementById("delay-mix")?.value||.3);a.delayNode.delayTime.value=u,a.delayFeedbackNode.gain.value=k,a.delayWetNode.gain.value=N,a.delayDryNode.gain.value=1-N}if(h){const u=Number.parseFloat(document.getElementById("reverb-decay")?.value||2),k=Number.parseFloat(document.getElementById("reverb-mix")?.value||.3),N=t.sampleRate,T=u*N,V=t.createBuffer(2,T,N);for(let A=0;A<V.numberOfChannels;A++){const z=V.getChannelData(A);for(let j=0;j<z.length;j++)z[j]=(Math.random()*2-1)*Math.pow(1-j/z.length,2)}a.reverbNode.buffer=V,a.reverbWetNode.gain.value=k,a.reverbDryNode.gain.value=1-k}if(v){const u=Number.parseFloat(document.getElementById("compressor-threshold")?.value||-24),k=Number.parseFloat(document.getElementById("compressor-ratio")?.value||4),N=Number.parseFloat(document.getElementById("compressor-attack")?.value||5)/1e3,T=Number.parseFloat(document.getElementById("compressor-release")?.value||250)/1e3;c.threshold.value=u,c.ratio.value=k,c.attack.value=N,c.release.value=T}let g=a.filterNode;if(n&&(g.connect(a.distortionNode),g=a.distortionNode),o){g.connect(a.delayDryNode),g.connect(a.delayNode),a.delayNode.connect(a.delayFeedbackNode),a.delayFeedbackNode.connect(a.delayNode),a.delayNode.connect(a.delayWetNode);const u=t.createGain();a.delayDryNode.connect(u),a.delayWetNode.connect(u),g=u}if(h){g.connect(a.reverbDryNode),g.connect(a.reverbNode),a.reverbNode.connect(a.reverbWetNode);const u=t.createGain();a.reverbDryNode.connect(u),a.reverbWetNode.connect(u),g=u}g.connect(c),console.log("Effects chain updated successfully")}function B(){const n=t.createMediaStreamDestination();c.connect(n),l=new MediaRecorder(n.stream),l.ondataavailable=o=>{d.push(o.data)},l.onstop=()=>{const o=new Blob(d,{type:"audio/wav"}),h=URL.createObjectURL(o),v=document.getElementById("downloadButton");v.href=h,v.download="recording.wav",v.disabled=!1}}document.getElementById("recordButton")?.addEventListener("click",()=>{t||f(),l||B(),d=[],l.start(),document.getElementById("recordButton").classList.add("recording"),document.getElementById("recordButton").disabled=!0,document.getElementById("stopButton").disabled=!1}),document.getElementById("stopButton")?.addEventListener("click",()=>{l.stop(),document.getElementById("recordButton").classList.remove("recording"),document.getElementById("recordButton").disabled=!1,document.getElementById("stopButton").disabled=!0});try{if(!document.getElementById("keyboard"))throw new Error("Keyboard div not found");console.log("Keyboard div found")}catch(n){console.error("Failed to find keyboard div:",n);const o=document.getElementById("keyboard-error");o&&(o.style.display="block")}document.getElementById("keyboard");const L=document.getElementById("resetToDefault"),F=document.getElementById("waveform1"),q=document.getElementById("waveform2"),O=document.getElementById("detune"),X=document.getElementById("oscMix"),Ce=document.getElementById("volume"),Y=document.getElementById("attack"),Z=document.getElementById("decay"),ee=document.getElementById("sustain"),U=document.getElementById("release"),Be=document.getElementById("filterCutoff"),Ne=document.getElementById("filterResonance"),Se=document.getElementById("lfoWaveform"),Ie=document.getElementById("lfoFrequency"),xe=document.getElementById("lfoAmount"),we=document.getElementById("lfoTarget"),W=document.getElementById("arpEnabled"),te=document.getElementById("arpPattern"),ne=document.getElementById("arpRate"),Q=document.getElementById("arpOctaves"),ae=document.getElementById("reverb-enabled"),oe=document.getElementById("reverb-mix"),se=document.getElementById("reverb-decay"),re=document.getElementById("delay-enabled"),ie=document.getElementById("delay-time"),ce=document.getElementById("delay-feedback"),le=document.getElementById("delay-mix"),de=document.getElementById("distortion-enabled"),ue=document.getElementById("distortion-amount"),me=document.getElementById("distortion-tone"),qe=document.getElementById("chorus-enabled"),Te=document.getElementById("chorus-rate"),Ae=document.getElementById("chorus-depth"),Le=document.getElementById("chorus-mix"),he=document.getElementById("compressor-enabled"),pe=document.getElementById("compressor-threshold"),ye=document.getElementById("compressor-ratio"),fe=document.getElementById("compressor-attack"),ve=document.getElementById("compressor-release"),ge=document.querySelectorAll(".tab-button"),De=document.querySelectorAll(".tab-content"),R={};let K=!1,x=[],P=null;const $=Object.fromEntries(Object.entries(G).map(([n,o])=>[n,o.freq])),H={},_={};Object.entries(G).forEach(([n,o])=>{o.key&&(_[o.key]=n)}),ge.forEach(n=>{n.addEventListener("click",()=>{console.log("Tab clicked:",n.dataset.tab),ge.forEach(v=>v.classList.remove("active")),De.forEach(v=>v.classList.remove("active")),n.classList.add("active");const o=n.dataset.tab,h=document.getElementById(`${o}-tab`);h?(h.classList.add("active"),console.log("Activated tab content:",o),o==="drum-machine"&&(Oe(),Re())):console.error("Tab content not found:",o)})});function be(){document.querySelectorAll('input[type="range"]').forEach(n=>{const o=n.nextElementSibling;o&&o.classList.contains("value-display")&&(o.textContent=n.value,n.addEventListener("input",()=>{o.textContent=n.value}))})}function Fe(){F.value="sine",q.value="sine",O.value="0",X.value="0.5",Ce.value="0.5",Y.value="0.1",Z.value="0.1",ee.value="0.8",U.value="0.5",Be.value="20000",Ne.value="1",Se.value="sine",Ie.value="1",xe.value="10",we.value="filterCutoff",W.checked=!1,te.value="up",ne.value="4",Q.value="1",ae.checked=!0,oe.value="0.3",se.value="2",re.checked=!0,ie.value="0.3",ce.value="0.4",le.value="0.3",de.checked=!1,ue.value="20",me.value="4000",qe.checked=!1,Te.value="1.5",Ae.value="0.7",Le.value="0.5",he.checked=!0,pe.value="-24",ye.value="4",fe.value="5",ve.value="250",J(),Object.keys(H).forEach(n=>{H[n]=0}),Me(),be(),t&&p(),console.log("Reset to default values"),alert("All settings have been reset to default values")}Q?.addEventListener("input",()=>{K&&(J(),Ee())});function M(n,o=null){if(t||f(),R[n])return console.log(`Cleaning up existing note ${n}`),D(n),setTimeout(()=>M(n,o),1);const h=o||$[n];if(!h){console.warn(`Note frequency not found for ${n}`);return}const v=t.createOscillator(),E=t.createOscillator();v.type=F.value,E.type=q.value,v.frequency.setValueAtTime(h,t.currentTime),E.frequency.setValueAtTime(h*Math.pow(2,O.value/1200),t.currentTime);const y=t.createGain(),w=t.createGain(),g=Number.parseFloat(X.value);y.gain.setValueAtTime(g,t.currentTime),w.gain.setValueAtTime(1-g,t.currentTime),v.connect(y),E.connect(w);const u=t.createGain();u.gain.setValueAtTime(0,t.currentTime),y.connect(u),w.connect(u),u.connect(a.filterNode);const k=Number.parseFloat(Y.value),N=Number.parseFloat(Z.value),T=Number.parseFloat(ee.value);Number.parseFloat(U.value),u.gain.linearRampToValueAtTime(1,t.currentTime+k),u.gain.linearRampToValueAtTime(T,t.currentTime+k+N),v.start(),E.start(),R[n]={osc1:v,osc2:E,gainNode1:y,gainNode2:w,adsrGain:u}}function D(n){if(!t||!R[n])return;const o=R[n],{osc1:h,osc2:v,adsrGain:E}=o,y=Number.parseFloat(U.value);E.gain.cancelScheduledValues(t.currentTime),E.gain.linearRampToValueAtTime(0,t.currentTime+y),setTimeout(()=>{h.stop(),v.stop(),h.disconnect(),v.disconnect(),E.disconnect(),delete R[n]},y*1e3)}document.addEventListener("keydown",n=>{const o=_[n.key];if(o&&!n.repeat){if(W.checked)ke(o,!0);else if(!b.has(o)){M(o),b.add(o);const h=document.querySelector(`[data-note="${o}"]`);h&&h.classList.add("active")}}}),document.addEventListener("keyup",n=>{const o=_[n.key];if(o)if(W.checked)ke(o,!1);else{D(o),b.delete(o);const h=document.querySelector(`[data-note="${o}"]`);h&&h.classList.remove("active")}}),window.addEventListener("blur",()=>{b.forEach(n=>{D(n);const o=document.querySelector(`[data-note="${n}"]`);o&&o.classList.remove("active")}),b.clear()});function Me(){Object.keys(H).forEach(n=>{$[n]=G[n].freq*Math.pow(2,H[n]/1200)})}function Ee(){t||f(),K=!0;const o=60/(Number.parseInt(ne.value)*15)*1e3,h=te.value,v=Number.parseInt(Q.value);let E=0;P=setInterval(()=>{if(x.length===0)return;let y;const w=x.length*v;switch(h){case"up":y=x[E%x.length];const g=Math.floor(E/x.length),u=$[y]*Math.pow(2,g);M(y,u),setTimeout(()=>D(y),o*.9),E=(E+1)%w;break;case"down":E=(w+E-1)%w,y=x[E%x.length],M(y),setTimeout(()=>D(y),o*.9);break;case"random":y=x[Math.floor(Math.random()*x.length)];const k=Math.floor(Math.random()*v),N=$[y]*Math.pow(2,k);M(y,N),setTimeout(()=>D(y),o*.9);break}},o)}function ke(n,o){W.checked&&(o&&!x.includes(n)?(x.push(n),K||Ee()):o||(x=x.filter(h=>h!==n),x.length===0&&J()))}function J(){P&&(clearInterval(P),P=null),K=!1}function ze(){const n={keyboardDiv:document.getElementById("keyboard"),octaves:[3,4,5],initAudioContext:f,startNote:M,stopNote:D};Ge(n),console.log("Keyboard initialized")}function Re(){t||f(),m=new We(t),console.log("Drum machine initialized with synthetic samples"),document.addEventListener("drumpad-toggle",n=>{const{row:o,step:h}=n.detail;m.toggleStep(o,h)}),document.getElementById("playDrums")?.addEventListener("click",()=>{m.start(),document.getElementById("playDrums").disabled=!0,document.getElementById("stopDrums").disabled=!1}),document.getElementById("stopDrums")?.addEventListener("click",()=>{m.stop(),document.getElementById("playDrums").disabled=!1,document.getElementById("stopDrums").disabled=!0}),document.getElementById("clearDrums")?.addEventListener("click",()=>{m.clear()}),document.getElementById("drumTempo")?.addEventListener("input",n=>{m.setTempo(parseInt(n.target.value)),n.target.nextElementSibling.textContent=n.target.value})}[ae,oe,se,re,ie,ce,le,de,ue,me,he,pe,ye,fe,ve].forEach(n=>{n&&(n.addEventListener("change",p),n.addEventListener("input",p))}),L?.addEventListener("click",Fe),f(),ze(),be(),console.log("JackSynth initialized successfully")});
